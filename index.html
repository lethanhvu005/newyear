<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ch√∫c m·ª´ng nƒÉm m·ªõi ‚ú®</title>
  <style>
    :root{
      --glass: rgba(255,255,255,.10);
      --glass2: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.14);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.72);
      --gold: #f6d36e;
      --red: #ff2e4d;
    }

    *{ box-sizing: border-box; }
    html,body{ height:100%; margin:0; overflow:hidden; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    body{ color: var(--text); background:#05060f; }

    .bg{
      position:fixed; inset:-30%;
      background:
        radial-gradient(circle at 15% 20%, rgba(255, 205, 90,.75), rgba(255,205,90,0) 40%),
        radial-gradient(circle at 80% 25%, rgba(255, 80, 200,.55), rgba(255,80,200,0) 45%),
        radial-gradient(circle at 60% 85%, rgba(60, 220, 255,.55), rgba(60,220,255,0) 50%),
        linear-gradient(120deg, #0b0f2a, #1c0b2d 55%, #001a2e);
      filter: saturate(1.15) contrast(1.05);
      animation: drift 18s ease-in-out infinite alternate;
      transform: translateZ(0);
      z-index: 0;
    }
    @keyframes drift{
      0%{ transform: translate(-2%, -2%) scale(1.02); }
      100%{ transform: translate(2%, 2%) scale(1.06); }
    }

    .grain{
      pointer-events:none;
      position:fixed; inset:0;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='120' height='120' filter='url(%23n)' opacity='.22'/%3E%3C/svg%3E");
      mix-blend-mode: overlay;
      opacity:.25;
      z-index: 2;
    }

    /* canvases now ABOVE the card (so not ‚Äúunder‚Äù) */
    canvas{ position:fixed; inset:0; width:100%; height:100%; z-index: 30; pointer-events:none; }

    /* floating lanterns */
    .float-layer{ position:fixed; inset:0; pointer-events:none; z-index: 12; }
    .floater{
      position:absolute;
      width: 84px; height: 110px;
      opacity: .95;
      filter: drop-shadow(0 16px 24px rgba(0,0,0,.35));
      animation: up 14s linear infinite;
      transform: translateZ(0);
    }
    .floater svg{ width:100%; height:100%; display:block; }
    @keyframes up{
      from{ transform: translate3d(0, 115vh, 0) rotate(0deg); }
      to{ transform: translate3d(0, -140px, 0) rotate(8deg); }
    }

    /* flying photo stickers (always visible) */
    .photo-layer{ position:fixed; inset:0; pointer-events:none; z-index: 45; }
    .photo{
      position:absolute;
      width: 86px; height: 86px;
      border-radius: 999px;
      overflow:hidden;
      transform: translateZ(0);
      filter: drop-shadow(0 18px 30px rgba(0,0,0,.38));
      animation: fly 11s linear infinite;
      opacity: .95;
    }
    .photo img{ width:100%; height:100%; object-fit:cover; }
    .photo .bubble{
      position:absolute;
      left: 60%;
      top: -18px;
      transform: translateX(-10px);
      padding: 7px 9px;
      background: rgba(255,255,255,.92);
      color: rgba(0,0,0,.85);
      border-radius: 999px;
      font-size: 12px;
      font-weight: 900;
      white-space: nowrap;
      box-shadow: 0 12px 25px rgba(0,0,0,.28);
    }
    .photo .bubble::after{
      content:"";
      position:absolute;
      left: 14px; bottom: -8px;
      width: 0; height: 0;
      border-left: 8px solid transparent;
      border-right: 8px solid transparent;
      border-top: 10px solid rgba(255,255,255,.92);
      transform: rotate(18deg);
    }
    @keyframes fly{
      from{ transform: translate3d(-18vw, 110vh, 0) rotate(-8deg); }
      to{ transform: translate3d(118vw, -22vh, 0) rotate(10deg); }
    }

    /* emoji/lucky icons layer */
    .emoji-layer{ position:fixed; inset:0; pointer-events:none; z-index: 44; }
    .emoji{
      position:absolute;
      font-size: 24px;
      filter: drop-shadow(0 14px 22px rgba(0,0,0,.35));
      animation: driftEmoji 10s linear infinite;
      opacity: .95;
      transform: translateZ(0);
    }
    @keyframes driftEmoji{
      from{ transform: translate3d(110vw, 110vh, 0) rotate(0deg); }
      to{ transform: translate3d(-20vw, -20vh, 0) rotate(360deg); }
    }

    .wrap{ position:fixed; inset:0; display:grid; place-items:center; padding: 22px; z-index: 25; }
    .card{
      width: min(920px, 100%);
      background: linear-gradient(180deg, var(--glass), var(--glass2));
      border:1px solid var(--stroke);
      border-radius: 28px;
      box-shadow: 0 28px 90px rgba(0,0,0,.48);
      backdrop-filter: blur(12px);
      overflow:hidden;
      position:relative;
    }
    .card::before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(circle at 30% 10%, rgba(255,255,255,.18), rgba(255,255,255,0) 40%);
      pointer-events:none;
    }
    .inner{ padding: 28px 24px 22px; display:grid; gap: 14px; text-align:center; }

    .title{ margin:0; font-size: clamp(26px, 4.6vw, 52px); letter-spacing: .5px; text-shadow: 0 10px 40px rgba(0,0,0,.35); }
    .year{
      font-size: clamp(54px, 10vw, 110px);
      line-height: 1; font-weight: 900; margin: 0;
      background: linear-gradient(90deg, #ffd36e, #ff60d6, #52e6ff, #ffd36e);
      background-size: 250% 100%;
      -webkit-background-clip:text; background-clip:text; color: transparent;
      animation: shine 4.5s linear infinite;
      filter: drop-shadow(0 18px 45px rgba(0,0,0,.35));
    }
    @keyframes shine{ 0%{ background-position:0% 50%; } 100%{ background-position:250% 50%; } }

    .msg{ margin:0; font-size: clamp(14px, 2.1vw, 18px); color: var(--muted); }

    .pillrow{ display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin-top: 6px; }
    .pill{
      pointer-events:auto; user-select:none;
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.14);
      color: rgba(255,255,255,.88);
      font-size: 13px;
      cursor: pointer;
      transition: transform .15s ease, background .15s ease, box-shadow .15s ease;
      min-width: 150px;
    }
    .pill:hover{ transform: translateY(-1px); background: rgba(0,0,0,.28); }
    .pill:active{ transform: translateY(0px) scale(.98); }

    .pill.primary{
      min-width: 210px;
      font-weight: 1000;
      font-size: 14px;
      letter-spacing: .25px;
      background: linear-gradient(180deg, rgba(255,46,77,.46), rgba(0,0,0,.20));
      border: 1px solid rgba(246,211,110,.42);
      box-shadow: 0 18px 42px rgba(0,0,0,.40);
      position: relative;
      isolation:isolate;
    }
    .pill.primary::before{
      content:"";
      position:absolute; inset:-2px;
      border-radius:999px;
      background: radial-gradient(circle at 20% 30%, rgba(246,211,110,.40), rgba(246,211,110,0) 55%);
      z-index:-1;
    }
    .pill.primary:hover{ transform: translateY(-2px) scale(1.02); box-shadow: 0 22px 50px rgba(0,0,0,.45); }

    .hint{ margin: 10px 0 0; font-size: 13px; color: rgba(255,255,255,.70); }

    .footer{
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      padding: 14px 18px 16px;
      border-top: 1px solid rgba(255,255,255,.10);
      color: rgba(255,255,255,.70);
      font-size: 12px;
    }
    .footer a{ color: rgba(255,255,255,.80); text-decoration:none; border-bottom:1px dashed rgba(255,255,255,.35); }
    .footer a:hover{ color: rgba(255,255,255,.95); }

    /* modal base */
    .modal{ position:fixed; inset:0; display:none; z-index: 80; }
    .modal.show{ display:block; }
    .backdrop{ position:absolute; inset:0; background: rgba(0,0,0,.55); backdrop-filter: blur(8px); }
    .panel{
      position:relative;
      width: min(980px, calc(100% - 28px));
      margin: 7vh auto 0;
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 24px;
      box-shadow: 0 40px 120px rgba(0,0,0,.55);
      overflow:hidden;
    }
    .panelHeader{
      display:flex; justify-content:space-between; align-items:center;
      padding: 14px 16px;
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .panelHeader h2{ margin:0; font-size: 16px; color: rgba(255,255,255,.92); }
    .closeBtn{
      cursor:pointer;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.22);
      color: rgba(255,255,255,.9);
      border-radius: 999px;
      padding: 8px 10px;
      font-size: 12px;
    }
    .panelBody{ padding: 16px; display:grid; gap: 14px; }

    /* Lucky */
    .luckyWrap{ display:grid; grid-template-columns: 1.1fr .9fr; gap: 14px; align-items: stretch; }
    @media (max-width: 860px){
      .luckyWrap{ grid-template-columns: 1fr; }
      .panel{ margin-top: 5vh; }
    }
    .cardMini{ background: rgba(0,0,0,.18); border: 1px solid rgba(255,255,255,.12); border-radius: 18px; padding: 14px; }
    .miniTitle{ margin:0 0 8px; font-size: 14px; color: rgba(255,255,255,.9); }
    .miniText{ margin:0; font-size: 13px; color: rgba(255,255,255,.72); line-height: 1.45; }

    .envelopeStage{
      position:relative;
      height: 270px;
      border-radius: 18px;
      background:
        radial-gradient(circle at 30% 20%, rgba(255,255,255,.14), rgba(255,255,255,0) 45%),
        rgba(0,0,0,.16);
      border: 1px solid rgba(255,255,255,.12);
      overflow:hidden;
      display:grid;
      place-items:center;
    }

    .env{
      width: 250px; height: 180px;
      position:relative;
      transform: translateZ(0);
      filter: drop-shadow(0 18px 28px rgba(0,0,0,.35));
    }
    .env .body{
      position:absolute; inset:0;
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(255, 50, 80,.95), rgba(145, 0, 30,.96));
      border: 1px solid rgba(255,255,255,.18);
    }
    .env .flap{
      position:absolute; left:0; right:0; top:-1px; height: 102px;
      background: linear-gradient(180deg, rgba(255, 160, 100,.96), rgba(255, 50, 80,.96));
      clip-path: polygon(0 0, 100% 0, 50% 100%);
      border-top-left-radius: 18px;
      border-top-right-radius: 18px;
      transform-origin: 50% 0%;
      transform: rotateX(0deg);
    }
    .env .seal{
      position:absolute; left:50%; top:56%;
      transform: translate(-50%,-50%);
      width: 64px; height: 64px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.6), rgba(255,255,255,0) 45%), var(--gold);
      border: 1px solid rgba(255,255,255,.30);
      display:grid; place-items:center;
      color: rgba(0,0,0,.82);
      font-weight: 1000;
      letter-spacing: .5px;
      text-shadow: 0 1px 0 rgba(255,255,255,.35);
    }
    .env .paper{
      position:absolute; left:12px; right:12px; bottom:12px; height: 132px;
      background: rgba(255,255,255,.94);
      border-radius: 14px;
      transform: translateY(74px);
      display:grid; place-items:center;
      color: rgba(0,0,0,.88);
      font-weight: 1000;
      font-size: 34px;
      letter-spacing: .5px;
      border: 1px solid rgba(0,0,0,.10);
      box-shadow: 0 14px 24px rgba(0,0,0,.18);
    }
    .env.open .flap{ animation: flapOpen .55s ease forwards; }
    .env.open .paper{ animation: paperUp .75s cubic-bezier(.2,.9,.2,1) forwards; }
    @keyframes flapOpen{ to{ transform: rotateX(70deg); } }
    @keyframes paperUp{
      0%{ transform: translateY(74px); }
      70%{ transform: translateY(-42px); }
      100%{ transform: translateY(-34px); }
    }

    /* Wheel */
    .wheelStage{ display:grid; grid-template-columns: 1fr 1fr; gap: 14px; align-items: center; }
    @media (max-width: 860px){ .wheelStage{ grid-template-columns: 1fr; } }

    .wheelBox{
      position:relative;
      display:grid;
      place-items:center;
      background: rgba(0,0,0,.16);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 18px;
      padding: 16px;
      overflow:hidden;
      min-height: 380px;
    }

    .wheelWrap{
      position:relative;
      width: 340px;
      height: 340px;
      display:grid;
      place-items:center;
    }

    /* pointer fixed: sits exactly on rim */
    .pointer{
      position:absolute;
      top: 6px;
      left: 50%;
      transform: translateX(-50%);
      width: 0; height: 0;
      border-left: 18px solid transparent;
      border-right: 18px solid transparent;
      border-bottom: 28px solid rgba(255,255,255,.98);
      filter: drop-shadow(0 14px 20px rgba(0,0,0,.45));
      z-index: 6;
    }
    .pointer::before{
      content:"";
      position:absolute;
      left:50%;
      transform: translateX(-50%);
      top: 22px;
      width: 18px; height: 18px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.65), rgba(255,255,255,0) 55%), var(--gold);
      box-shadow: 0 10px 18px rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.28);
    }

    .wheel{
      width: 340px;
      height: 340px;
      border-radius: 50%;
      border: 1px solid rgba(255,255,255,.18);
      box-shadow: 0 22px 60px rgba(0,0,0,.48);
      position:relative;
      transform: rotate(0deg);
      transition: transform 3.8s cubic-bezier(.10,.90,.10,1);
      will-change: transform;
      background: conic-gradient(
        rgba(255,211,110,.95) 0deg 72deg,
        rgba(255,96,214,.95) 72deg 144deg,
        rgba(82,230,255,.95) 144deg 216deg,
        rgba(255,140,90,.95) 216deg 288deg,
        rgba(180,255,140,.95) 288deg 360deg
      );
      overflow:hidden;
    }
    .wheel::after{
      content:"";
      position:absolute; inset:16px;
      border-radius:50%;
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(6px);
      pointer-events:none;
      z-index: 1; /* IMPORTANT: keep below labels */
    }

    /* labels above wheel::after and rotate with wheel */
    .wheelLabels{
      position:absolute; inset:0;
      pointer-events:none;
      z-index: 3;
    }
    .wlabel{
      position:absolute;
      left:50%; top:50%;
      transform-origin: 0 0;
      font-size: 14px;
      font-weight: 1000;
      color: rgba(0,0,0,.82);
      text-shadow: 0 1px 0 rgba(255,255,255,.35);
      white-space: nowrap;
      user-select:none;
    }

    .wheelCenter{
      position:absolute; inset:0;
      display:grid; place-items:center;
      pointer-events:none;
      z-index: 5;
    }
    .wheelCenter .btnSpin{
      pointer-events:auto;
      border:none;
      cursor:pointer;
      width: 120px; height: 120px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.55), rgba(255,255,255,0) 48%), var(--gold);
      color: rgba(0,0,0,.88);
      font-weight: 1000;
      font-size: 16px;
      box-shadow: 0 20px 42px rgba(0,0,0,.38);
      border: 1px solid rgba(255,255,255,.28);
      transition: transform .15s ease;
    }
    .wheelCenter .btnSpin:hover{ transform: scale(1.03); }
    .wheelCenter .btnSpin:active{ transform: scale(.98); }

    .resultLine{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; }
    .resultBadge{
      display:inline-flex; align-items:center; gap:8px;
      padding: 10px 12px; border-radius: 14px;
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.9);
      font-size: 13px;
    }
    .bigResult{ font-size: 18px; font-weight: 1000; letter-spacing: .2px; }

    /* Music overlay */
    .tapOverlay{
      position:fixed; inset:0; display:none; place-items:center; z-index: 90;
      background: rgba(0,0,0,.55); backdrop-filter: blur(6px);
    }
    .tapOverlay button{
      font: 700 16px system-ui;
      padding: 14px 16px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      color: rgba(255,255,255,.95);
      cursor: pointer;
    }
  </style>
</head>

<body>
  <div class="bg"></div>
  <div class="grain"></div>

  <!-- Now ABOVE card -->
  <canvas id="confetti"></canvas>
  <canvas id="fireworks"></canvas>

  <div class="float-layer" id="floatLayer" aria-hidden="true"></div>
  <div class="emoji-layer" id="emojiLayer" aria-hidden="true"></div>
  <div class="photo-layer" id="photoLayer" aria-hidden="true"></div>

  <div class="tapOverlay" id="tapOverlay">
    <button type="button">üéµ Ch·∫°m ƒë·ªÉ b·∫≠t nh·∫°c</button>
  </div>

  <div class="wrap">
    <div class="card">
      <div class="inner">
        <h1 class="title">Ch√∫c m·ª´ng nƒÉm m·ªõi! ‚ú®</h1>
        <div class="year" id="year">2026</div>
        <p class="msg" id="msg">
          Ch√∫c b·∫°n m·ªôt nƒÉm m·ªõi an khang, th·ªãnh v∆∞·ª£ng, nhi·ªÅu may m·∫Øn v√† tr√†n ƒë·∫ßy nƒÉng l∆∞·ª£ng t√≠ch c·ª±c!
        </p>

        <div class="pillrow">
          <button class="pill" id="btnBurst" type="button">üéÜ B·∫Øn ph√°o hoa</button>
          <button class="pill" id="btnConfetti" type="button">üéâ Th√™m confetti</button>
          <button class="pill primary" id="btnLucky" type="button">üßß R√∫t l√¨ x√¨</button>
          <button class="pill primary" id="btnWheel" type="button">üé° V√≤ng quay</button>
          <button class="pill" id="btnMusic" type="button">üîä B·∫≠t nh·∫°c</button>
        </div>

        <p class="hint">Tip: click/ch·∫°m m√†n h√¨nh ƒë·ªÉ t·∫°o ph√°o hoa ·ªü v·ªã tr√≠ b·∫°n ch·∫°m.</p>
      </div>

      <div class="footer">
        <span>Made for QR ‚Ä¢ m·ªü tr√™n ƒëi·ªán tho·∫°i c√†ng ƒë·∫πp</span>
        <span><a href="#" id="copyLink">Copy link</a></span>
      </div>
    </div>
  </div>

  <!-- L√å X√å MODAL -->
  <div class="modal" id="luckyModal" aria-hidden="true">
    <div class="backdrop" data-close="lucky"></div>
    <div class="panel" role="dialog" aria-modal="true" aria-labelledby="luckyTitle">
      <div class="panelHeader">
        <h2 id="luckyTitle">üßß R√∫t bao l√¨ x√¨</h2>
        <button class="closeBtn" type="button" data-close="lucky">ƒê√≥ng ‚úï</button>
      </div>
      <div class="panelBody">
        <div class="luckyWrap">
          <div class="envelopeStage">
            <div class="env" id="env">
              <div class="body"></div>
              <div class="flap"></div>
              <div class="seal">L·ªòC</div>
              <div class="paper" id="envPaper">‚Äî</div>
            </div>
          </div>

          <div class="cardMini">
            <p class="miniTitle">Th·ªÉ l·ªá</p>
            <p class="miniText">
              B·∫•m <b>‚ÄúR√∫t ngay‚Äù</b> ƒë·ªÉ m·ªü bao l√¨ x√¨. X√°c su·∫•t ƒë√∫ng:
              <b>100k 15%</b>, <b>50k 30%</b>, <b>20k 40%</b>, <b>10k 10%</b>, <b>5k 5%</b>.
            </p>
            <div style="height:10px"></div>
            <div class="resultLine">
              <span class="resultBadge">K·∫øt qu·∫£: <span class="bigResult" id="luckyResult">‚Äî</span></span>
              <button class="pill primary" id="btnLuckyDraw" type="button">üßß R√∫t ngay</button>
            </div>
            <div style="height:8px"></div>
            <p class="miniText" id="luckyJoke">Tip: r√∫t nhi·ªÅu l·∫ßn cho vui üòÑ</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- WHEEL MODAL -->
  <div class="modal" id="wheelModal" aria-hidden="true">
    <div class="backdrop" data-close="wheel"></div>
    <div class="panel" role="dialog" aria-modal="true" aria-labelledby="wheelTitle">
      <div class="panelHeader">
        <h2 id="wheelTitle">üé° V√≤ng quay l√¨ x√¨</h2>
        <button class="closeBtn" type="button" data-close="wheel">ƒê√≥ng ‚úï</button>
      </div>

      <div class="panelBody">
        <div class="wheelStage">
          <div class="wheelBox">
            <div class="wheelWrap">
              <div class="pointer" aria-hidden="true"></div>
              <div class="wheel" id="wheel">
                <div class="wheelLabels" id="wheelLabels" aria-hidden="true"></div>
              </div>
              <div class="wheelCenter">
                <button class="btnSpin" id="btnSpin" type="button">SPIN</button>
              </div>
            </div>
          </div>

          <div class="cardMini">
            <p class="miniTitle">T·ª∑ l·ªá tr√∫ng</p>
            <p class="miniText" id="oddsText"></p>
            <div style="height:10px"></div>
            <div class="resultLine">
              <span class="resultBadge">Tr√∫ng: <span class="bigResult" id="wheelResult">‚Äî</span></span>
              <button class="pill primary" id="btnSpinAlt" type="button">üé° Quay</button>
            </div>
            <div style="height:10px"></div>
            <p class="miniText" id="wheelJoke">Nh√¨n m≈©i t√™n nha, tr√∫ng √¥ n√†o l√† √¥ ƒë√≥ üëÄ</p>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  const DPR = Math.min(2, window.devicePixelRatio || 1);
  const rand = (a,b)=> a + Math.random()*(b-a);

  document.getElementById('year').textContent = new Date().getFullYear();

  // lantern floaters
  const layer = document.getElementById('floatLayer');
  const floaterSVG = (hue=30) => `
    <svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="g" x1="0" x2="0" y1="0" y2="1">
          <stop offset="0" stop-color="hsla(${hue},100%,70%,1)"/>
          <stop offset="1" stop-color="hsla(${(hue+35)%360},100%,55%,1)"/>
        </linearGradient>
        <radialGradient id="shine" cx="30%" cy="25%" r="60%">
          <stop offset="0" stop-color="rgba(255,255,255,.65)"/>
          <stop offset="1" stop-color="rgba(255,255,255,0)"/>
        </radialGradient>
      </defs>
      <path d="M50 8 C 20 8, 12 36, 12 58 C 12 92, 30 112, 50 112 C 70 112, 88 92, 88 58 C 88 36, 80 8, 50 8 Z"
            fill="url(#g)" opacity=".95"/>
      <path d="M50 8 C 20 8, 12 36, 12 58 C 12 92, 30 112, 50 112 C 70 112, 88 92, 88 58 C 88 36, 80 8, 50 8 Z"
            fill="url(#shine)" opacity=".55"/>
      <path d="M42 110 L58 110 L54 121 L46 121 Z" fill="rgba(255,255,255,.65)" opacity=".45"/>
      <path d="M50 121 C 44 126, 54 128, 48 132" stroke="rgba(255,255,255,.45)" stroke-width="2" fill="none"/>
    </svg>
  `;
  function spawnFloater(){
    const el = document.createElement('div');
    el.className = 'floater';
    const hue = rand(0,360);
    el.innerHTML = floaterSVG(hue);
    const left = rand(2, 92);
    const dur = rand(10, 18);
    const delay = rand(0, 6);
    const size = rand(56, 96);
    el.style.left = left + 'vw';
    el.style.width = size + 'px';
    el.style.height = size * 1.28 + 'px';
    el.style.animationDuration = dur + 's';
    el.style.animationDelay = (-delay) + 's';
    el.style.opacity = String(rand(0.55, 0.95));
    layer.appendChild(el);
    setTimeout(()=> el.remove(), (dur+2)*1000);
  }
  for(let i=0;i<10;i++) spawnFloater();
  setInterval(spawnFloater, 1400);

  // flying photos (your stickers)
  const photoLayer = document.getElementById('photoLayer');
  const PHOTO_PATHS = ["sticker1.png","sticker2.png","sticker3.png","sticker4.png","sticker5.png"];
  const BUBBLES = ["L·ªôc t·ªõi n√®!", "Quay 100k ƒëi!!!", "√ä tr√∫ng ch∆∞a?", "T·ªõi c√¥ng chuy·ªán!", "H√∫ h√∫ l√¨ x√¨!", "V√≠a m·∫°nh l√™n ‚ú®", "ƒê·ª´ng xui nha üò≠", "Ch·ªët ƒë∆°n 20k!"];

  function spawnPhoto(){
    const wrap = document.createElement('div');
    wrap.className = 'photo';
    const img = document.createElement('img');
    img.src = PHOTO_PATHS[Math.floor(Math.random()*PHOTO_PATHS.length)];
    img.alt = "photo";
    const bubble = document.createElement('div');
    bubble.className = 'bubble';
    bubble.textContent = BUBBLES[Math.floor(Math.random()*BUBBLES.length)];

    const size = rand(66, 104);
    const dur = rand(9.2, 15.2);
    const delay = rand(0, 7);

    wrap.style.width = size + "px";
    wrap.style.height = size + "px";
    wrap.style.animationDuration = dur + "s";
    wrap.style.animationDelay = (-delay) + "s";
    wrap.style.top = rand(6, 78) + "vh";
    wrap.style.left = (-rand(18, 42)) + "vw";

    wrap.appendChild(img);
    if(Math.random() < 0.75) wrap.appendChild(bubble);

    photoLayer.appendChild(wrap);
    setTimeout(()=> wrap.remove(), (dur+2)*1000);
  }
  for(let i=0;i<6;i++) spawnPhoto();
  setInterval(spawnPhoto, 1500);

  // emoji icons (üòÇüßßüéÜüéà‚ú®)
  const emojiLayer = document.getElementById('emojiLayer');
  const EMOJIS = ["üòÇ","ü§£","üßß","üßß","üéÜ","üéá","üéà","‚ú®","ü´ß","üí•","üòé","üòõ"];
  function spawnEmoji(){
    const e = document.createElement('div');
    e.className = 'emoji';
    e.textContent = EMOJIS[Math.floor(Math.random()*EMOJIS.length)];
    e.style.fontSize = rand(18, 34) + "px";
    e.style.animationDuration = rand(7.5, 12.5) + "s";
    e.style.animationDelay = (-rand(0, 6)) + "s";
    e.style.left = rand(0, 100) + "vw";
    e.style.top = rand(0, 100) + "vh";
    emojiLayer.appendChild(e);
    setTimeout(()=> e.remove(), 14000);
  }
  for(let i=0;i<14;i++) spawnEmoji();
  setInterval(spawnEmoji, 900);

  // canvases
  const cConf = document.getElementById('confetti');
  const xConf = cConf.getContext('2d');
  const cFire = document.getElementById('fireworks');
  const xFire = cFire.getContext('2d');
  xFire.globalCompositeOperation = 'lighter';

  function resizeCanvas(c){
    c.width = Math.floor(innerWidth * DPR);
    c.height = Math.floor(innerHeight * DPR);
  }
  function resizeAll(){
    resizeCanvas(cConf);
    resizeCanvas(cFire);
  }
  addEventListener('resize', resizeAll);
  resizeAll();

  // confetti
  const confetti = [];
  function addConfetti(amount=180){
    for(let i=0;i<amount;i++){
      confetti.push({
        x: rand(0, cConf.width),
        y: rand(-cConf.height*0.2, cConf.height*0.2),
        vx: rand(-.6,.6) * DPR,
        vy: rand(1.6, 3.6) * DPR,
        r: rand(2.2, 5.2) * DPR,
        rot: rand(0, Math.PI*2),
        vr: rand(-.12,.12),
        hue: rand(0,360),
        life: rand(140, 240),
      });
    }
  }
  addConfetti(120);

  function confLoop(){
    xConf.clearRect(0,0,cConf.width,cConf.height);
    for(let i=confetti.length-1;i>=0;i--){
      const p = confetti[i];
      p.life -= 1;
      p.x += p.vx;
      p.y += p.vy;
      p.rot += p.vr;
      p.vx += Math.sin((p.y / (140*DPR))) * 0.002 * DPR;
      const a = Math.max(0, Math.min(1, p.life/220));
      xConf.save();
      xConf.translate(p.x, p.y);
      xConf.rotate(p.rot);
      xConf.globalAlpha = a;
      xConf.fillStyle = `hsla(${p.hue}, 100%, 70%, 1)`;
      xConf.fillRect(-p.r, -p.r*0.6, p.r*2, p.r*1.2);
      xConf.restore();
      if(p.y > cConf.height + 40 || p.x < -60 || p.x > cConf.width + 60 || p.life <= 0) confetti.splice(i,1);
    }
    if(confetti.length < 140) addConfetti(30);
    requestAnimationFrame(confLoop);
  }
  confLoop();

  // fireworks
  const sparks = [];
  function burst(px, py, power=1){
    const n = Math.floor(rand(50, 90) * power);
    for(let i=0;i<n;i++){
      const a = rand(0, Math.PI*2);
      const sp = rand(1.8, 5.8) * DPR * power;
      sparks.push({
        x:px, y:py,
        vx: Math.cos(a)*sp,
        vy: Math.sin(a)*sp,
        hue: rand(0,360),
        r: rand(1.2, 2.6)*DPR,
        life: rand(55, 110),
      });
    }
  }

  let t = 0;
  function fireLoop(){
    t++;
    xFire.clearRect(0, 0, cFire.width, cFire.height);

    // NOTE: we clear fully so the canvas stays transparent and won't cover the greeting text
if(t % 34 === 0){
      burst(rand(cFire.width*0.15, cFire.width*0.85), rand(cFire.height*0.12, cFire.height*0.55), rand(0.8, 1.25));
    }

    for(let i=sparks.length-1;i>=0;i--){
      const p = sparks[i];
      p.life -= 1;
      p.vx *= 0.985;
      p.vy = p.vy*0.985 + 0.03*DPR;
      p.x += p.vx;
      p.y += p.vy;

      const a = Math.max(0, Math.min(1, p.life/110));
      xFire.beginPath();
      xFire.fillStyle = `hsla(${p.hue}, 100%, 70%, ${a})`;
      xFire.arc(p.x, p.y, p.r, 0, Math.PI*2);
      xFire.fill();

      if(p.life <= 0 || p.x < -80 || p.x > cFire.width+80 || p.y > cFire.height+120) sparks.splice(i,1);
    }

    requestAnimationFrame(fireLoop);
  }
  for(let i=0;i<4;i++){
    burst(rand(cFire.width*0.2, cFire.width*0.8), rand(cFire.height*0.18, cFire.height*0.55), rand(0.9, 1.15));
  }
  fireLoop();

  function tap(ev){
    const rect = cFire.getBoundingClientRect();
    const cx = ('touches' in ev) ? ev.touches[0].clientX : ev.clientX;
    const cy = ('touches' in ev) ? ev.touches[0].clientY : ev.clientY;
    burst((cx - rect.left)*DPR, (cy - rect.top)*DPR, 1.2);
  }
  addEventListener('click', tap);
  addEventListener('touchstart', tap, {passive:true});

  // main buttons
  document.getElementById('btnBurst').addEventListener('click', () => {
    burst(rand(cFire.width*0.2, cFire.width*0.8), rand(cFire.height*0.12, cFire.height*0.55), 1.35);
  });
  document.getElementById('btnConfetti').addEventListener('click', () => addConfetti(220));

  // copy link
  document.getElementById('copyLink').addEventListener('click', async (e) => {
    e.preventDefault();
    const url = location.href;
    try{
      await navigator.clipboard.writeText(url);
      alert("ƒê√£ copy link ‚úÖ\n" + url);
    }catch{
      prompt("Copy link n√†y ƒë·ªÉ t·∫°o QR:", url);
    }
  });

  // weighted prizes
  const PRIZES = [
    { label: "100k", weight: 15 },
    { label: "50k",  weight: 30 },
    { label: "20k",  weight: 40 },
    { label: "10k",  weight: 10 },
    { label: "5k",   weight: 5  },
  ];
  function pickWeighted(items){
    const total = items.reduce((s,x)=> s + x.weight, 0);
    let r = Math.random() * total;
    for(const it of items){
      r -= it.weight;
      if(r <= 0) return it;
    }
    return items[items.length-1];
  }

  // modal helpers
  const luckyModal = document.getElementById('luckyModal');
  const wheelModal = document.getElementById('wheelModal');
  function show(modal){ modal.classList.add('show'); modal.setAttribute('aria-hidden','false'); }
  function hide(modal){ modal.classList.remove('show'); modal.setAttribute('aria-hidden','true'); }
  document.querySelectorAll('[data-close="lucky"]').forEach(el => el.addEventListener('click', () => hide(luckyModal)));
  document.querySelectorAll('[data-close="wheel"]').forEach(el => el.addEventListener('click', () => hide(wheelModal)));
  addEventListener('keydown', (e) => { if(e.key === 'Escape'){ hide(luckyModal); hide(wheelModal); } });

  // Lucky
  const env = document.getElementById('env');
  const envPaper = document.getElementById('envPaper');
  const luckyResult = document.getElementById('luckyResult');
  const luckyJoke = document.getElementById('luckyJoke');
  const JOKES = ["R√∫t kh√©o k·∫ªo bay v√≠ üò≠", "V√≠a m·∫°nh l√™n!!", "ƒê·ª´ng run tay nha üòÜ", "Ai tr√∫ng 100k th√¨ m·ªùi tr√† s·ªØa!", "Tr√∫ng 5k c≈©ng l√† tr√∫ng üòé"];
  function envelopeReset(){
    env.classList.remove('open');
    envPaper.textContent = "‚Äî";
    luckyResult.textContent = "‚Äî";
  }
  document.getElementById('btnLucky').addEventListener('click', () => {
    envelopeReset();
    luckyJoke.textContent = JOKES[Math.floor(Math.random()*JOKES.length)];
    show(luckyModal);
  });
  document.getElementById('btnLuckyDraw').addEventListener('click', () => {
    envelopeReset();
    setTimeout(() => {
      const prize = pickWeighted(PRIZES);
      envPaper.textContent = prize.label;
      luckyResult.textContent = prize.label;
      env.classList.add('open');
      addConfetti(140);
      burst(rand(cFire.width*0.25, cFire.width*0.75), rand(cFire.height*0.15, cFire.height*0.45), 1.05);
      if(navigator.vibrate) navigator.vibrate([20, 40, 20]);
    }, 120);
  });

  // Wheel
  const wheel = document.getElementById('wheel');
  const wheelLabels = document.getElementById('wheelLabels');
  const wheelResult = document.getElementById('wheelResult');
  const oddsText = document.getElementById('oddsText');
  const wheelJoke = document.getElementById('wheelJoke');

  oddsText.innerHTML = PRIZES.map(p => `<b>${p.label}</b>: ${p.weight}%`).join(" ‚Ä¢ ");

  const SEG = [
    { label:"100k", prize:"100k", index:0 },
    { label:"50k",  prize:"50k",  index:1 },
    { label:"20k",  prize:"20k",  index:2 },
    { label:"10k",  prize:"10k",  index:3 },
    { label:"5k",   prize:"5k",   index:4 },
  ];

  function buildWheelLabels(){
    wheelLabels.innerHTML = "";
    const radius = 126;
    for(const s of SEG){
      const mid = s.index*72 + 36; // segment center
      const angle = mid - 90;      // align 0 at top
      const el = document.createElement('div');
      el.className = 'wlabel';
      el.style.transform = `rotate(${angle}deg) translate(${radius}px, -12px)`;
      el.textContent = s.label;
      wheelLabels.appendChild(el);
    }
  }
  buildWheelLabels();

  let spinning = false;
  let currentRotation = 0;

  function spinWheel(){
    if(spinning) return;
    spinning = true;
    wheelResult.textContent = "‚Ä¶";

    const prize = pickWeighted(PRIZES).label;
    const seg = SEG.find(s => s.prize === prize);

    const centerAngle = seg.index*72 + 36;   // from 3 o'clock
    const target = 270 - centerAngle;        // to top pointer
    const extra = 360 * (3 + Math.floor(Math.random()*3));
    currentRotation = currentRotation + extra + target;

    wheel.style.transform = `rotate(${currentRotation}deg)`;

    setTimeout(() => {
      wheelResult.textContent = prize;
      wheelJoke.textContent = ["M≈©i t√™n ch·ªâ ƒë√¢u, l·ªôc ·ªü ƒë√≥ üòé", "Tr√∫ng r·ªìi nha, kh·ªèi c√£i üòÜ", "∆† k√¨a! l·ªôc r∆°i tr√∫ng ƒë·∫ßu!", "C·∫ßu g√¨ ƒë∆∞·ª£c n·∫•y ‚ú®"][Math.floor(Math.random()*4)];
      addConfetti(170);
      burst(rand(cFire.width*0.2, cFire.width*0.8), rand(cFire.height*0.15, cFire.height*0.5), 1.1);
      if(navigator.vibrate) navigator.vibrate([15, 35, 15]);
      spinning = false;
    }, 3950);
  }

  document.getElementById('btnWheel').addEventListener('click', () => show(wheelModal));
  document.getElementById('btnSpin').addEventListener('click', spinWheel);
  document.getElementById('btnSpinAlt').addEventListener('click', spinWheel);

  // Music
  let audio = new Audio("song.mp3");
  audio.loop = true;
  audio.volume = 0.35;

  let playing = false;
  const btnMusic = document.getElementById('btnMusic');
  const tapOverlay = document.getElementById('tapOverlay');

  function setMusicLabel(){ btnMusic.textContent = playing ? 'üîà T·∫Øt nh·∫°c' : 'üîä B·∫≠t nh·∫°c'; }
  setMusicLabel();

  async function tryAutoplay(){
    try{
      await audio.play();
      playing = true;
      setMusicLabel();
    }catch{
      tapOverlay.style.display = 'grid';
    }
  }
  tapOverlay.addEventListener('click', async () => {
    try{
      await audio.play();
      playing = true;
      setMusicLabel();
      tapOverlay.style.display = 'none';
    }catch{
      alert("Kh√¥ng ph√°t ƒë∆∞·ª£c nh·∫°c. H√£y ki·ªÉm tra b·∫°n ƒë√£ upload song.mp3 ch∆∞a.");
    }
  });
  btnMusic.addEventListener('click', async () => {
    try{
      if(!playing){
        await audio.play();
        playing = true;
        tapOverlay.style.display = 'none';
      }else{
        audio.pause();
        playing = false;
      }
      setMusicLabel();
    }catch{
      tapOverlay.style.display = 'grid';
    }
  });

  tryAutoplay();
})();
</script>
</body>
</html>
